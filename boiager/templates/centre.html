{% extends 'base.html' %}
{% block content %}
    <div class="section">
        <a href="/centres">Centres</a> &#8594 <b>{{ centre.name }}</b>
    </div>
    <div class="divider"></div>
    <div class="section">
        <h5>{{ centre.name }}</h5>
        <div class="row">
            <div class="col s4">
            <p>{{ centre.description }}</p>
            {% if centre.img %}
                <div class="section"><img src="{{centre.img}}" alt=""></div>
            {% endif %}
            {% comment %}{% if boies %}
                {% for boia in boies %}
                    <p>Boia {{boia.location_name}}</p>
                {% endfor %}
            {% endif %}{% endcomment %}
            </div>
            <div class="col s8">
                <div id="map"></div>
            </div>
        </div>
    </div>
{% endblock %}
{% block scripts %}
    <script>
        var data = {{data|safe}};
        var boies = data.map(function(boia) {
            return boia.fields;
        });
        var map;
        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                center: {lat: {{map_centre.lat|floatformat:7}}, lng:{{map_centre.lng|floatformat:7}} },
                zoom: 15,
                scrollwheel: false,
                disableDefaultUI: true,
                draggable: false,
                mapTypeId: google.maps.MapTypeId.SATELLITE, //TERRAIN,SATELLITE,ROADMAP,HYBRID
                styles:[{"featureType":"landscape.natural","elementType":"geometry.fill","stylers":[{"visibility":"on"},{"color":"#e0efef"}]},{"featureType":"poi","elementType":"geometry.fill","stylers":[{"visibility":"on"},{"hue":"#1900ff"},{"color":"#c0e8e8"}]},{"featureType":"road","elementType":"geometry","stylers":[{"lightness":100},{"visibility":"simplified"}]},{"featureType":"road","elementType":"labels","stylers":[{"visibility":"off"}]},{"featureType":"transit.line","elementType":"geometry","stylers":[{"visibility":"on"},{"lightness":700}]},{"featureType":"water","elementType":"all","stylers":[{"color":"#80cbc4"}]}]
            });
            for( var i = 0; i < boies.length; i++) {
                var marker = new google.maps.Marker({
                    position: { lat: parseFloat(boies[i].lat), lng: parseFloat(boies[i].lng)},
                    map: map,
                    title: boies[i].location_name,
                    icon: 'http://maps.google.com/mapfiles/ms/icons/blue-dot.png',
                    boia_id: data[i].pk
                });
                marker.addListener('click', function() {
                    window.location.href = '/centre/' + {{centre.id}} + '/' + this.boia_id;
                });
            }
        }
        
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCxxnEczYMOs4eAAM-RMTvFPzK5xxLn_NE&callback=initMap"
        async defer></script>
{% endblock %}